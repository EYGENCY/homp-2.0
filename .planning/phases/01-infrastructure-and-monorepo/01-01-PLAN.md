---
phase: 01-infrastructure-and-monorepo
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/config/package.json
  - packages/config/tsconfig.json
  - packages/config/src/index.ts
  - packages/config/src/server.ts
  - packages/config/src/client.ts
  - .env.example
  - .gitignore
autonomous: true
requirements:
  - INFRA-05

must_haves:
  truths:
    - "Importing `@homp/config/server` in any package throws a clear Zod error if DATABASE_URL is missing"
    - "Importing `@homp/config/client` never exposes DATABASE_URL or REDIS_URL to the browser bundle"
    - "`.env.example` documents every required env var with a local default and an inline comment"
    - "No `.env` file or secret appears in git history"
  artifacts:
    - path: "packages/config/src/server.ts"
      provides: "Zod-validated serverEnv schema (DATABASE_URL, REDIS_URL, S3_*, NODE_ENV, PORT)"
      exports: ["serverEnv"]
    - path: "packages/config/src/client.ts"
      provides: "Zod-validated clientEnv schema (NEXT_PUBLIC_API_URL)"
      exports: ["clientEnv"]
    - path: "packages/config/src/index.ts"
      provides: "Re-exports serverEnv and clientEnv"
      exports: ["serverEnv", "clientEnv"]
    - path: "packages/config/package.json"
      provides: "@homp/config JIT internal package with exports field"
      contains: "\"name\": \"@homp/config\""
    - path: ".env.example"
      provides: "All required env vars with local defaults and comments"
      contains: "DATABASE_URL"
    - path: ".gitignore"
      provides: "Gitignore covering .env at root and in app subdirectories"
      contains: ".env"
  key_links:
    - from: "packages/config/package.json"
      to: "packages/config/src/server.ts"
      via: "exports field: \"./server\": \"./src/server.ts\""
      pattern: "\"./server\""
    - from: "packages/config/src/server.ts"
      to: "@t3-oss/env-core"
      via: "createEnv() call"
      pattern: "createEnv"
    - from: "packages/config/src/client.ts"
      to: "@t3-oss/env-nextjs"
      via: "createEnv() call"
      pattern: "createEnv"
---

<objective>
Create `packages/config` as the Zod-validated env schema package for the monorepo, and establish the `.env.example` and `.gitignore` that govern secret hygiene.

Purpose: Every app imports env from `@homp/config` — never raw `process.env`. Fail-fast validation catches missing vars at startup before anything breaks silently. The client/server split prevents secrets from reaching browser bundles.

Output: `@homp/config` JIT package with `serverEnv` and `clientEnv` exports; `.env.example` with all vars documented; root `.gitignore` protecting secrets.
</objective>

<execution_context>
@/Users/sr/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sr/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-infrastructure-and-monorepo/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create packages/config as JIT internal package</name>
  <files>
    packages/config/package.json
    packages/config/tsconfig.json
    packages/config/src/index.ts
    packages/config/src/server.ts
    packages/config/src/client.ts
  </files>
  <action>
The `packages/config` directory exists but is empty. Create the full JIT internal package.

**packages/config/package.json** — JIT package, no build step needed, exports TypeScript source directly:
```json
{
  "name": "@homp/config",
  "version": "0.1.0",
  "exports": {
    ".": "./src/index.ts",
    "./server": "./src/server.ts",
    "./client": "./src/client.ts"
  },
  "dependencies": {
    "zod": "^4.3.6",
    "@t3-oss/env-core": "^0.13.10",
    "@t3-oss/env-nextjs": "^0.13.10"
  }
}
```
Note: no `main` or `types` field — the `exports` field is the only entry point. JIT packages omit build output fields.

**packages/config/tsconfig.json**:
```json
{
  "extends": "../../tsconfig.json",
  "include": ["src/**/*.ts"],
  "exclude": ["node_modules"]
}
```
If no root tsconfig.json exists, create a minimal one instead (compilerOptions: strict, module: ESNext, moduleResolution: Bundler, target: ES2022).

**packages/config/src/server.ts** — server-only env schema using `@t3-oss/env-core` (not the Next.js variant, which is for client splits):
```typescript
import { createEnv } from "@t3-oss/env-core";
import { z } from "zod";

export const serverEnv = createEnv({
  server: {
    DATABASE_URL: z.string().url(),
    REDIS_URL: z.string().url(),
    NODE_ENV: z
      .enum(["development", "test", "production"])
      .default("development"),
    PORT: z.coerce.number().default(3001),
    // Object storage: MinIO locally, Railway Bucket in production
    S3_ENDPOINT: z.string().url(),
    S3_BUCKET: z.string().min(1),
    S3_ACCESS_KEY_ID: z.string().min(1),
    S3_SECRET_ACCESS_KEY: z.string().min(1),
    S3_REGION: z.string().default("us-east-1"),
  },
  runtimeEnv: process.env,
  emitErrors: true,
});
```

**packages/config/src/client.ts** — client-safe env schema using `@t3-oss/env-nextjs` (handles NEXT_PUBLIC_ inlining):
```typescript
import { createEnv } from "@t3-oss/env-nextjs";
import { z } from "zod";

export const clientEnv = createEnv({
  client: {
    NEXT_PUBLIC_API_URL: z.string().url(),
  },
  runtimeEnv: {
    NEXT_PUBLIC_API_URL: process.env.NEXT_PUBLIC_API_URL,
  },
});
```

**packages/config/src/index.ts**:
```typescript
export { serverEnv } from "./server";
export { clientEnv } from "./client";
```

After creating files, install dependencies in the package:
```bash
cd /Users/sr/homp-2.0 && pnpm --filter @homp/config install
```
  </action>
  <verify>
From monorepo root:
```bash
cd /Users/sr/homp-2.0
# Verify package is recognized by pnpm workspace
pnpm --filter @homp/config exec ls src/
# Should show: client.ts  index.ts  server.ts
```
  </verify>
  <done>
`packages/config/src/` contains `server.ts`, `client.ts`, and `index.ts`. `packages/config/package.json` has `exports` field pointing to TypeScript source files. `@t3-oss/env-core`, `@t3-oss/env-nextjs`, and `zod` are listed as dependencies.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create .env.example and root .gitignore</name>
  <files>
    .env.example
    .gitignore
  </files>
  <action>
**`.env.example`** at monorepo root — every required var with local dev defaults and explanatory comments. This file IS committed to git:

```bash
# =============================================================================
# HOMP 2.0 — Environment Variables
# Copy this file to .env and fill in your values.
# The .env file is gitignored; NEVER commit it.
# =============================================================================

# --- Database ---
# Local: PostgreSQL 16 via docker compose (postgres:5432)
# Railway: set automatically via variable reference ${{Postgres.DATABASE_URL}}
DATABASE_URL=postgresql://postgres:password@localhost:5432/homp

# --- Redis ---
# Local: Redis 7 via docker compose (redis:6379)
# Railway: set automatically via variable reference ${{Redis.REDIS_URL}}
REDIS_URL=redis://localhost:6379

# --- API URL (browser-safe) ---
# URL the Next.js web app uses to reach the Hono API
# Local: Hono runs on port 3001
# Railway: https://your-api-service.up.railway.app
NEXT_PUBLIC_API_URL=http://localhost:3001

# --- Object Storage (S3-compatible) ---
# Local: MinIO via docker compose (port 9000)
# Production: Railway Storage Bucket (endpoint and creds auto-provisioned)
S3_ENDPOINT=http://localhost:9000
S3_BUCKET=homp-dev
S3_ACCESS_KEY_ID=minioadmin
S3_SECRET_ACCESS_KEY=minioadmin
S3_REGION=us-east-1

# --- Runtime ---
NODE_ENV=development
# Port for the Hono API server (web runs on 3000 by default via Next.js)
PORT=3001
```

**`.gitignore`** at monorepo root — covers secrets at all depths:

```gitignore
# Dependencies
node_modules/
.pnpm-store/

# Secrets — NEVER commit .env files
.env
.env.local
.env.production
.env.production.local
apps/web/.env
apps/api/.env

# Build outputs
.next/
dist/
out/

# Turbo cache
.turbo/

# OS
.DS_Store
Thumbs.db

# Editor
.vscode/
.idea/

# Railway
.railway/

# Logs
*.log
npm-debug.log*
pnpm-debug.log*
```

Also create a real `.env` at monorepo root with the same content as `.env.example` (for local development). This `.env` is gitignored.
  </action>
  <verify>
```bash
# Verify .env.example is committed-safe (no real secrets)
grep -q "DATABASE_URL" /Users/sr/homp-2.0/.env.example
grep -q "S3_ENDPOINT" /Users/sr/homp-2.0/.env.example
# Verify .env is gitignored
grep -q "^\.env$" /Users/sr/homp-2.0/.gitignore
```
  </verify>
  <done>
`.env.example` exists at monorepo root with all 9 required vars documented. `.gitignore` exists and contains `.env` patterns. A local `.env` (gitignored) is ready for development.
  </done>
</task>

</tasks>

<verification>
1. `packages/config/package.json` has `name: "@homp/config"` and `exports` field pointing to TypeScript source
2. `packages/config/src/server.ts` exports `serverEnv` using `createEnv` from `@t3-oss/env-core`
3. `packages/config/src/client.ts` exports `clientEnv` using `createEnv` from `@t3-oss/env-nextjs`
4. `.env.example` contains all 9 vars: DATABASE_URL, REDIS_URL, NEXT_PUBLIC_API_URL, S3_ENDPOINT, S3_BUCKET, S3_ACCESS_KEY_ID, S3_SECRET_ACCESS_KEY, S3_REGION, NODE_ENV, PORT
5. `.gitignore` includes `.env` — no secrets will be committed
</verification>

<success_criteria>
- `@homp/config` is a valid pnpm workspace package resolvable via `pnpm --filter @homp/config`
- `serverEnv` schema validates DATABASE_URL, REDIS_URL, S3_*, NODE_ENV, PORT
- `clientEnv` schema validates NEXT_PUBLIC_API_URL only (no server secrets)
- `.env.example` has every var with local defaults and comments
- `.env` is gitignored at root and app levels
</success_criteria>

<output>
After completion, create `.planning/phases/01-infrastructure-and-monorepo/01-01-SUMMARY.md`
</output>
